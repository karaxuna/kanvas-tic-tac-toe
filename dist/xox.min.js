!function(n){n.utils={merge:function(n,t){var i={};return t=t||[Array],this.extend(i,n,t),i},extend:function(n,t,i){for(var e,r=0;e=t[r];r++)for(var o in e)if(e.hasOwnProperty(o)){var a=!1;if(i)for(var r=0;r<i.length;r++)e[o]instanceof i[r]&&(a=!0);"object"!=typeof e[o]||a?n[o]=e[o]:(n[o]=void 0!==n[o]?n[o]:{},this.extend(n[o],[e[o]],i))}},setProp:function(n,t,i){for(var e,r=t.split("."),o=n,a=0;e=r[a];a++)a===r.length-1?o[e]=i:o=o[e]=o[e]||{}},getProp:function(n,t){for(var i,e=t.split("."),r=n,o=0;i=e[o];o++){if(o===e.length-1)return r[i];r=r[i]||{}}},findOne:function(n,t,i){for(var e,r=0;e=n[r];r++)var o=this.matchesQuery(e,t);return o?(i&&i(e,r),e):(i&&i(null),null)},matchesQuery:function(n,t){switch(typeof t){case"object":for(var i in t){var e=this.getProp(n,i);if(e!==t[i])return!1}return!0;case"function":return t(n)}},find:function(n,t,i){for(var e,r=[],o=0;e=n[o];o++)this.matchesQuery(e,t)&&r.push(e);return i&&i(r),r},contains:function(n,t,i){for(var e,r=0;e=n[r];r++)if(this.equals(e,t,i))return!0;return!1},any:function(n,t){for(var i,e=0;i=n[e];e++)if(this.matchesQuery(i,t))return!0;return!1},union:function(n,t,i,e){for(var r=[],o=0;o<n.length;o++)r.push(n[o]);for(var o=0;o<t.length;o++){var a=!this.contains(n,t[o],i);a&&r.push(t[o])}return e&&e(r),r},except:function(n,t,i,e){for(var r=[],o=0;o<n.length;o++){var a=n[o];this.contains(t,a,i)||r.push(a)}return e&&e(r),r},max:function(n){for(var t,i=0;i<n.length;i++){var e=n[i];("undefined"==typeof t||e>t)&&(t=e)}return t},equals:function(n,t,i){for(var e in i){var r=this.getProp(n,e),o=this.getProp(t,e);if(r!==o)return!1}return!0},chain:function(n){return function(){return n.apply(this,arguments),this}}}}(window.kanvas=window.kanvas||{}),function(n){var t=n.utils,i=n.EventTarget=function(){var n=this;n._listeners={}};i.prototype={constructor:i,on:t.chain(function(n,t){"undefined"==typeof this._listeners[n]&&(this._listeners[n]=[]),this._listeners[n].push(t)}),trigger:t.chain(function(n,t){if(this._listeners[n]instanceof Array)for(var i=this._listeners[n],e=0,r=i.length;r>e;e++)t instanceof Array?i[e].apply(this,t):i[e].call(this,t)}),removeListener:t.chain(function(n,t){if(this._listeners[n]instanceof Array)for(var i=this._listeners[n],e=0,r=i.length;r>e;e++)if(i[e]===t){i.splice(e,1);break}})}}(window.kanvas=window.kanvas||{}),function(n){n.Vector=function(n,t){var i=this;i.x=n,i.y=t}}(window.kanvas=window.kanvas||{}),function(n){var t=n.utils,i=n.Point=function(n,t){var i=this;i.x=n,i.y=t};t.extend(i.prototype,[{move:t.chain(function(n){var t=this;t.x+=n.x,t.y+=n.y}),copy:function(){var n=this;return new i(n.x,n.y)}}])}(window.kanvas=window.kanvas||{}),function(n){n.Size=function(n,t){var i=this;i.width=n,i.height=t}}(window.kanvas=window.kanvas||{}),function(n){var t=n.utils,i=n.EventTarget,e=n.Point,r=n.Vector,o=n.Mouse=function(n){var t=this;i.call(t),t.container=n,t.down=!1,t.curr=new e(null,null),t.diff=new r(0,0),n.addEventListener("mousemove",function(i){var e=i.clientX-n.offsetLeft+document.body.scrollLeft,r=i.clientY-n.offsetTop+document.body.scrollTop;t.diff.x=e-t.curr.x,t.diff.y=r-t.curr.y,t.curr.x=e,t.curr.y=r,t.trigger("move",i)}),n.addEventListener("mousedown",function(n){t.down=!0,t.trigger("down",n)}),n.addEventListener("mouseup",function(n){t.down=!1,t.trigger("up",n)}),n.addEventListener("click",function(n){t.trigger("click",n)})};t.extend(o.prototype,[i.prototype])}(window.kanvas=window.kanvas||{}),function(n){var t=n.utils,i=n.EventTarget,e=n.Figure=function(n,t){var e=this;i.call(e),e.parent=n,e.position=t};t.extend(e.prototype,[i.prototype,{move:t.chain(function(n){var t=this;t.position.move(n)}),getAbsPosition:function(){var n=this;return n.parent?n.parent.getAbsPosition().copy().move(n.position):n.position}}])}(window.kanvas=window.kanvas||{}),function(n){var t=n.utils,i=n.Figure,e=n.Point,r=(n.Vector,n.Circle=function(n,t,e,r){var o=this;i.call(o,n,t),o.radius=e,o.lineWidth=r});t.extend(r.prototype,[i.prototype,{draw:t.chain(function(n){var t=this,i=n.context,e=t.getAbsCenter(),r=t.radius,o=t.lineWidth;i.beginPath(),i.arc(e.x,e.y,r,0,2*Math.PI,!1),i.lineWidth=o,i.stroke()}),pointInside:function(n){var t=this,i=t.radius,e=t.getAbsCenter();return(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)<=i*i},getAbsCenter:function(){var n=this,t=n.getAbsPosition();return new e(t.x+n.radius,t.y+n.radius)}}])}(window.kanvas=window.kanvas||{}),function(n){var t=n.utils,i=n.Figure,e=(n.Point,n.Vector,n.Line=function(n,t,e,r,o){var a=this;i.call(a,n,t),a.start=e,a.end=r,a.width=o});t.extend(e.prototype,[i.prototype,{draw:t.chain(function(n){var t=this,i=n.context,e=t.getAbsPosition(),r=e.copy().move(t.start),o=e.copy().move(t.end),a=t.width;i.beginPath(),i.lineWidth=a,i.moveTo(r.x,r.y),i.lineTo(o.x,o.y),i.stroke()}),pointInside:function(){return!1}}])}(window.kanvas=window.kanvas||{}),function(n){var t=n.utils,i=n.EventTarget,e=n.Mouse,r=n.Scene=function(n){var t=this;i.call(t),t.context=n,t.figures=[],t.mouse=new e(n.canvas)};t.extend(r.prototype,[i.prototype,{add:t.chain(function(n,t){var i=this;i.figures.splice(void 0===t?i.figures.length-1:t,0,n)}),draw:t.chain(function(){for(var n,t=this,i=0;n=t.figures[i];i++)n.draw(t)}),redraw:t.chain(function(){var n=this;n.clear().draw()}),clear:t.chain(function(){var n=this;n.context.clearRect(0,0,n.context.canvas.width,n.context.canvas.height)})}])}(window.kanvas=window.kanvas||{}),function(n){function t(n,t){{var i=this;i.values={}}i.width=n,i.height=t}t.prototype.iterate=function(n){var t,i,e=this,r=e.width,o=e.height,a=e.values;for(t=0;r>t;t++)for(i=0;o>i;i++)n(t,i,a[t]?a[t][i]:null)},t.prototype.get=function(n,t){var i=this;return i.values[n][t]},t.prototype.set=function(n,t,i){var e=this;e.values[n]=e.values[n]||{},e.values[n][t]=i},n.Matrix=t}(window.xox=window.xox||{}),function(n){function t(n,t,i,e,o,s,c){var u=this,h=new a(t*e.width,i*e.height);r.call(u,n,h),u.i=t,u.j=i,u.size=e,u.type=o,u.padding=s,u.lineWidth=c}var i=kanvas.Circle,e=kanvas.Line,r=kanvas.Figure,o=kanvas.utils,a=kanvas.Point,s=kanvas.Vector;o.extend(t.prototype,[r.prototype,{draw:o.chain(function(n){var t,r,o=this,c=o.type,u=o.padding,h=o.lineWidth,f=o.size.width,v=o.size.height;f===v?(t=v,r=new s(u,u)):f>v?(t=v,r=new s((f-t)/2+u,u)):(t=f,r=new s(u,(v-t)/2+u));var w=new a(0,0).move(r);if("o"===c){var d=t/2-u,l=new i(o,w,d,h);l.draw(n)}else if("x"===c){var p=new e(o,w,new a(0,0),new a(t-2*u,t-2*u),h),g=new e(o,w,new a(0,t-2*u),new a(t-2*u,0),h);p.draw(n),g.draw(n)}}),pointInside:function(n){var t=this,i=t.getAbsPosition(),e=t.size;return n.x>=i.x&&n.x<=i.x+e.width&&n.y>=i.y&&n.y<=i.y+e.height}}]),n.Block=t}(window.xox=window.xox||{}),function(n){function t(n,t,i,r){var u=this,h=new o(0,0);e.call(u,null,h);var f=u.matrix=new s(n,t);u.lineWidth=i,u.padding=r,f.iterate(function(n,t){f.set(n,t,new c(u,n,t,new a(0,0),null,r,5))})}var i=(kanvas.Circle,kanvas.Line),e=kanvas.Figure,r=kanvas.utils,o=kanvas.Point,a=kanvas.Size,s=n.Matrix,c=n.Block;r.extend(t.prototype,[e.prototype,{clean:r.chain(function(){var n=this;n.matrix.iterate(function(n,t,i){i.type=null})}),getBlockByAbsPosition:function(n){var t,i=this,e=i.matrix;return e.iterate(function(i,e,r){r.pointInside(n)&&(t=r)}),t},fill:r.chain(function(n,t,i){var e=this,r=e.matrix.width,o=e.matrix.height;if(n>r||0>n||t>o||0>t)throw new Error("Invalid parameters");var a=e.matrix.get(n,t);if(a.type)throw new Error("Block is already filled");a.type=i}),draw:r.chain(function(n){{var t=this,e=t.matrix,r=t.matrix.width,s=t.matrix.height,c=t.lineWidth,u=n.context.canvas;t.padding}e.iterate(function(t,i,e){var c=e.size=new a(u.width/r,u.height/s);e.position=new o(t*c.width,i*c.height),e.draw(n)});var h,f,v;for(h=0;r>=h;h++)v=new i(t,new o(0,0),new o(h*u.width/r,0),new o(h*u.width/r,u.height),c),v.draw(n);for(f=0;s>=f;f++)v=new i(t,new o(0,0),new o(0,f*u.height/s),new o(u.width,f*u.height/s),c),v.draw(n)}),pointInside:function(n){return!1}}]),n.Board=t}(window.xox=window.xox||{}),function(n){function t(n){var t=this;r.call(t),t.options=n,t.turn=n.turn||"x",t.me=n.me,t.winner,t.winningScore=n.winningScore||3;var o=t.board=new i(n.width||3,n.height||3,1,10),a=t.scene=new e(n.context);a.mouse.on("click",function(){var n=o.getBlockByAbsPosition(a.mouse.curr);n&&t.fill(n.i,n.j,!0)}),a.add(o,0),a.draw()}var i=n.Board,e=kanvas.Scene,r=kanvas.EventTarget,o=kanvas.utils;o.extend(t.prototype,[r.prototype,{restart:o.chain(function(){var n=this;n.board.clean(),n.winner=null,n.turn=n.options.turn||"x",n.scene.redraw()}),fill:o.chain(function(n,t,i){var e=this,r=e.turn,o=e.me,a=e.board,s=e.scene;if(e.winner)throw new Error("Game is over");if(i&&o&&o!==r)throw new Error("Not your turn");a.fill(n,t,r),s.redraw(),e.trigger("filled",{i:n,j:t,type:r});var c=e.check(n,t,r);c?(e.winner=r,e.trigger("over")):"x"===r?e.turn="o":"o"===r&&(e.turn="x")}),check:function(n,t,i){var e=this,r=e.board,o=r.matrix,a=o.width,s=o.height,c=e.winningScore,u=[[1,0],[0,1],[1,-1],[1,1]].some(function(e){for(var r,u=e[0],h=n,f=e[1],v=t,w=1,d=!1;;)if(h+=u,v+=f,0>h||h>=a||0>v||v>=s){if(d)return!1;h=n,v=t,u=-u,f=-f,d=!0}else if(r=o.get(h,v),r.type===i){if(++w===c)return!0}else{if(d)return!1;h=n,v=t,u=-u,f=-f,d=!0}});return u}}]),n.Game=t}(window.xox=window.xox||{});